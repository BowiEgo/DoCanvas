!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).XCanvas=e()}(this,(function(){"use strict";var n=function(){return n=Object.assign||function(n){for(var e,t=arguments,r=1,o=arguments.length;r<o;r++)for(var i in e=t[r])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},n.apply(this,arguments)};var e=Object.freeze({}),t=Object.freeze([]),r=/^on[^a-z]/,o=function(n){return r.test(n)},i=Array.isArray,l=function(n){return"function"==typeof n},u=function(n){return"string"==typeof n},c=function(n){return null!==n&&"object"==typeof n};function a(n){if(i(n)){for(var e={},t=0;t<n.length;t++){var r=n[t],o=u(r)?v(r):a(r);if(o)for(var l in o)e[l]=o[l]}return e}return u(n)||c(n)?n:void 0}!function(){try{return Boolean(wx.getSystemInfoSync)}catch(n){return!1}}();var f,d=/;(?![^(]*\))/g,s=/:([^]+)/,p=/\/\*.*?\*\//gs;function v(n){var e={};return n.replace(p,"").split(d).forEach((function(n){if(n){var t=n.split(s);t.length>1&&(e[t[0].trim()]=t[1].trim())}})),e}function h(n){var e="";if(u(n))e=n;else if(i(n))for(var t=0;t<n.length;t++){var r=h(n[t]);r&&(e+=r+" ")}else if(c(n))for(var o in n)n[o]&&(e+=o+" ");return e.trim()}(f={})[1]="TEXT",f[2]="CLASS",f[4]="STYLE",f[8]="PROPS",f[16]="FULL_PROPS",f[32]="HYDRATE_EVENTS",f[64]="STABLE_FRAGMENT",f[128]="KEYED_FRAGMENT",f[256]="UNKEYED_FRAGMENT",f[512]="NEED_PATCH",f[1024]="DYNAMIC_SLOTS",f[2048]="DEV_ROOT_FRAGMENT",f[-1]="HOISTED",f[-2]="BAIL";var y=Symbol.for("v-fgt"),g=Symbol.for("v-cmt");function _(n){return!!n&&!0===n.__v_isVNode}function x(n,e,t,r){if(void 0===e&&(e=null),void 0===t&&(t=null),_(n)){var o=m(n,e);return t&&function(n,e){null==e?e=null:i(e)||"object"==typeof e||l(e)||(e=[E(e)]);n.children=e}(o,t),o}if(e){var f=e.class,d=e.style;f&&!u(f)&&(e.class=h(f)),c(d)&&(e.style=a(d))}return function(n,e,t,r){return void 0===e&&(e=null),void 0===t&&(t=null),{__v_isVNode:!0,__v_skip:!0,type:n,props:e,children:t,component:null,el:null,staticCount:0,appContext:null,ctx:null}}(n,e,t)}function m(n,e,t){if(n&&"object"!=typeof n)return n;var r=n.props,l=n.children,u=e?function(){for(var n=arguments,e=[],t=0;t<arguments.length;t++)e[t]=n[t];for(var r={},l=0;l<e.length;l++){var u=e[l];for(var c in u)if("class"===c)r.class!==u.class&&(r.class=h([r.class,u.class]));else if("style"===c)r.style=a([r.style,u.style]);else if(o(c)){var f=r[c],d=u[c];!d||f===d||i(f)&&f.includes(d)||(r[c]=f?[].concat(f,d):d)}else""!==c&&(r[c]=u[c])}return r}(r||{},e):r;return{__v_isVNode:!0,type:n.type,props:u,children:i(l)?l.map(b):l,staticCount:n.staticCount,appContext:n.appContext,component:n.component,el:n.el,ctx:n.ctx}}function b(n){var e=m(n);return i(n.children)&&(e.children=n.children.map(b)),e}function E(n,e){return void 0===n&&(n=" "),x("Text",null,n)}function A(n){return null==n||"boolean"==typeof n?x(g):i(n)?x(y,null,n.slice()):"object"==typeof n?function(n){return m(n)}(n):E(String(n))}var C=0;function T(n){return function(e,t){void 0===t&&(t=null);var r={_uid:C++,_component:e,_props:t,_container:null,_instance:null,mount:function(o){var i=x(e,t);r._container=o,n(i,o)}};return r}}var O=[],S=[],N=null,w=0,P=100;function j(n){if(S.length){var e=function(n,e,t){if(t||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return n.concat(r||Array.prototype.slice.call(e))}([],new Set(S),!0);if(S.length=0,N)return void N.push.apply(N,e);for(N=e,n=n||new Map,N.sort((function(n,e){return I(n)-I(e)})),w=0;w<N.length;w++)L(n,N[w])||N[w]();N=null,w=0}}var I=function(n){return null==n.id?1/0:n.id};function L(n,e){if(n.has(e)){var t=n.get(e);if(t>P)return!0;n.set(e,t+1)}else n.set(e,1)}var R=function(n){var e=[];if(null!=n){var t=[],r=void 0,o=void 0;for(t.unshift(n);0!=t.length;)if(r=t.shift(),e.push(r),o=r.children,i(o))for(var l=0;l<o.length;l++)t.push(o[l])}return e},D=function(n){var e=[];return function n(t){0!==t.children.length&&t.children.forEach((function(e){n(e)})),e.push(t)}(n),e};function M(){var n={stackingContext:null,_body:null,get body(){return n._body},set body(e){n._body=e,e.context=n},onElementAdd:function(e){var t,r,o,i;e.root===n.body&&(console.log("onElementAdd",e),n.stackingContext=(r={element:t=e,negativeZIndex:[],zeroOrAutoZIndexOrTransformedOrOpacity:[],positiveZIndex:[],nonPositionedFloats:[],nonPositionedInlineLevel:[],inlineLevel:[],nonInlineLevel:[]},o=R(t.node),i=D(t.node),console.log("breathArr",o),console.log("postOrderDeepArr",i),r))}};return n}function k(n){return{canvas:n.canvas,ctx:n.ctx,dpr:n.dpr||1,render:function(){}}}function F(n){return!!n&&!0===n.__v_isTreeNode}function V(n){var e={__v_isTreeNode:!0,_children:n.children||[],parent:null,prev:null,next:null,instance:n.instance||null,set children(n){e._children=n},get children(){return e._children||[]},get root(){return t(this)},hasChildren:function(){return!(!Array.isArray(e._children)||!e._children.length)},appendChild:function(n){if(!F(n))throw Error("Unknown treeNode type");var t=e._children[e._children.length-1]||null;t&&F(t)&&B(t,t.prev,n);Array.isArray(e._children)&&e._children.push(n),function(n,e){n.parent=e}(n,e),B(n,t,null)},prependChild:function(n){if(!F(n))throw Error("Unknown treeNode type")},removeChild:function(n){if(!F(n))throw Error("Unknown treeNode type")},append:function(){},prepend:function(){},remove:function(){}};function t(n){return n.parent?t(n.parent):n}return e}function B(n,e,t){n.prev=e,n.next=t}function U(n){return n.paint=function(){var n=this.getRenderer();this.options.render?this.options.render(n.getCtx(),n.getCanvas(),this):(n._drawBackground(this),n._drawBox(this))},n}function Y(n){return n.debugColor="blue",n.paint=function(){},n}var z=function(n){return e=n.reverse(),r=e.length,o=0,function n(){for(var i=arguments,l=[],u=0;u<arguments.length;u++)l[u]=i[u];return t=e[o].apply(this,l),o>=r-1?(o=0,t):(o++,n.call(null,t))};var e,t,r,o};function G(e,t,r,o){void 0===r&&(r={});var i=n(n({},{__v_isCanvasElement:!0,type:t,options:r,styles:{},context:e,node:null,debugColor:null}),{appendChild:function(n){l.appendChild(n.node),i.context.onElementAdd(n)},isVisible:function(){return!0}}),l=V({instance:i});return i.node=l,Object.defineProperty(i,"root",{get:function(){return l.root.instance}}),Object.defineProperty(i,"container",{get:function(){return l.parent?l.parent.instance:null}}),Object.defineProperty(i,"prevSibling",{get:function(){return l.prev?l.prev.instance:null}}),Object.defineProperty(i,"nextSibling",{get:function(){return l.next?l.next.instance:null}}),Object.defineProperty(i,"children",{get:function(){return u(o)?o:l.children.map((function(n){return n.instance}))}}),"body"===i.type&&(i.styles={width:"100%",height:"100%"}),i}function H(n){return function(e,t,r){return void 0===t&&(t={}),"text"===e?z([Y,G])(n,e,t,r):z([U,G])(n,e,t,r)}}var Z={createAppAPI:T,createNodeOps:function(n){return{insert:function(n,e,t){n&&e.appendChild(n)},remove:function(n){},createElement:function(e,t){var r=(t=t||{}).style;return n("view",{style:r})},createText:function(e){return n("text",{},e)},createComment:function(n){},setText:function(n,e){},setElementText:function(n,e){},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling}}},createRenderer:function(n){var r=n.insert,o=n.remove,i=n.patchProp,l=n.createElement,u=n.createText;n.createComment;var c=n.setText,a=n.setElementText;n.parentNode;var f=n.nextSibling,d=function(n,e,t,r,o){if(void 0===r&&(r=null),void 0===o&&(o=null),n!==e)if(n&&!function(n,e){return n.type===e.type}(n,e)&&(r=C(n),m(n,o,!0),n=null),"Text"===e.type)s(n,e,t,r);else p(n,e,t,r,o)},s=function(n,e,t,o){null==n?r(u(e.children),t,o):e.children!==n.children&&c(e,e.children)},p=function(n,e,t,r,o){null==n?v(e,t,r,o):y(n,e,o)},v=function(n,e,t,o){var i;n.type;var u=n.props;i=n.el=l(n.type,u),h(n.children,i,null,o),r(i,e,t)},h=function(n,e,t,r,o){if(void 0===o&&(o=0),"string"==typeof n)d(null,A(n),e,t,r);else for(var i=o;i<n.length;i++){var l=A(n[i]);d(null,l,e,t,r)}},y=function(n,t,r){var o=t.el=n.el,i=n.props||e,l=t.props||e;g(n,t,o,null,r),n.children!==t.children&&a(o,t.children),x(o,t,i,l,r)},g=function(n,e,t,r,o){var i=n&&n.children,l=e.children;_(i,l,t,r,o)},_=function(n,e,r,o,i){e=e||t;var l,u=(n=n||t).length,c=e.length,a=Math.min(u,c);for(l=0;l<a;l++){var f=A(e[l]);d(n[l],f,r,null,i)}u>c?E(n,i,!0,!1,a):h(e,r,o,i,a)},x=function(n,t,r,o,l){if(r!==o){if(r!==e)for(var u in r)i(n,u,r[u],null,t.children,l,E);for(var u in o){var c=o[u],a=r[u];c!==a&&"value"!==u&&i(n,u,a,c,t.children,l,E)}"value"in o&&i(n,"value",r.value,o.value)}},m=function(n,e,t,r){void 0===t&&(t=!1),n.type,n.props;var o=n.children;E(o,e),t&&b(n)},b=function(n){o(n)},E=function(n,e,t,r,o){void 0===t&&(t=!1),void 0===o&&(o=0);for(var i=o;i<n.length;i++)m(n[i],e,t)},C=function(n){return f(n)},S=function(n,e){null==n?e._vnode&&m(e._vnode,null,!0):d(e._vnode||null,n,e,null,null),function(n,e){for(void 0===e&&(e=0),n=n||new Map;e<O.length;e++){var t=O[e];if(t&&t.pre){if(L(n,t))continue;O.splice(e,1),e--,t()}}}(),j(),e._vnode=n};return{render:S,createApp:T(S)}},h:function(n,e,t){var r=arguments.length;return 2===r?c(e)&&!i(e)?_(e)?x(n,null,[e]):x(n,e):x(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):3===r&&_(t)&&(t=[t]),x(n,e,t))},createDoCanvas:function(n){var e=M(),t={context:e,renderer:k(n),createElement:H(e)};return e.body=t.createElement("body"),t.renderer.render(),t}};return Z}));
//# sourceMappingURL=x-canvas.js.map
