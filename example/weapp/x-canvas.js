!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).XCanvas=e()}(this,(function(){"use strict";!function(){try{return Boolean(wx.getSystemInfoSync)}catch(n){return!1}}();var n=Object.freeze({}),e=Object.freeze([]),t=/^on[^a-z]/,r=function(n){return t.test(n)},i=Array.isArray,o=function(n){return"function"==typeof n},l=function(n){return"string"==typeof n},u=function(n){return null!==n&&"object"==typeof n};function a(n){if(i(n)){for(var e={},t=0;t<n.length;t++){var r=n[t],o=l(r)?s(r):a(r);if(o)for(var c in o)e[c]=o[c]}return e}return l(n)||u(n)?n:void 0}var c,f=/;(?![^(]*\))/g,d=/:([^]+)/,p=/\/\*.*?\*\//gs;function s(n){var e={};return n.replace(p,"").split(f).forEach((function(n){if(n){var t=n.split(d);t.length>1&&(e[t[0].trim()]=t[1].trim())}})),e}function h(n){var e="";if(l(n))e=n;else if(i(n))for(var t=0;t<n.length;t++){var r=h(n[t]);r&&(e+=r+" ")}else if(u(n))for(var o in n)n[o]&&(e+=o+" ");return e.trim()}(c={})[1]="TEXT",c[2]="CLASS",c[4]="STYLE",c[8]="PROPS",c[16]="FULL_PROPS",c[32]="HYDRATE_EVENTS",c[64]="STABLE_FRAGMENT",c[128]="KEYED_FRAGMENT",c[256]="UNKEYED_FRAGMENT",c[512]="NEED_PATCH",c[1024]="DYNAMIC_SLOTS",c[2048]="DEV_ROOT_FRAGMENT",c[-1]="HOISTED",c[-2]="BAIL";var v=Symbol.for("v-fgt"),g=Symbol.for("v-cmt");function y(n){return!!n&&!0===n.__v_isVNode}function b(n,e,t,r){if(void 0===e&&(e=null),void 0===t&&(t=null),y(n)){var c=m(n,e);return t&&function(n,e){null==e?e=null:i(e)||"object"==typeof e||o(e)||(e=[_(e)]);n.children=e}(c,t),c}if(e){var f=e.class,d=e.style;f&&!l(f)&&(e.class=h(f)),u(d)&&(e.style=a(d))}return function(n,e,t,r){return void 0===e&&(e=null),void 0===t&&(t=null),{__v_isVNode:!0,__v_skip:!0,type:n,props:e,children:t,component:null,el:null,staticCount:0,appContext:null,ctx:null}}(n,e,t)}function m(n,e,t){if(n&&"object"!=typeof n)return n;var o=n.props,l=n.children,u=e?function(){for(var n=arguments,e=[],t=0;t<arguments.length;t++)e[t]=n[t];for(var o={},l=0;l<e.length;l++){var u=e[l];for(var c in u)if("class"===c)o.class!==u.class&&(o.class=h([o.class,u.class]));else if("style"===c)o.style=a([o.style,u.style]);else if(r(c)){var f=o[c],d=u[c];!d||f===d||i(f)&&f.includes(d)||(o[c]=f?[].concat(f,d):d)}else""!==c&&(o[c]=u[c])}return o}(o||{},e):o;return{__v_isVNode:!0,type:n.type,props:u,children:i(l)?l.map(x):l,staticCount:n.staticCount,appContext:n.appContext,component:n.component,el:n.el,ctx:n.ctx}}function x(n){var e=m(n);return i(n.children)&&(e.children=n.children.map(x)),e}function _(n,e){return void 0===n&&(n=" "),b("Text",null,n)}function C(n){return null==n||"boolean"==typeof n?b(g):i(n)?b(v,null,n.slice()):"object"==typeof n?function(n){return m(n)}(n):_(String(n))}var S=0;function T(n){return function(e,t){void 0===t&&(t=null);var r={_uid:S++,_component:e,_props:t,_container:null,_instance:null,mount:function(i){var o=b(e,t);r._container=i,n(o,i)}};return r}}var E=[],R=[],w=null,O=0,j=100;function A(n){if(R.length){var e=function(n,e,t){if(t||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))}([],new Set(R),!0);if(R.length=0,w)return void w.push.apply(w,e);for(w=e,n=n||new Map,w.sort((function(n,e){return V(n)-V(e)})),O=0;O<w.length;O++)N(n,w[O])||w[O]();w=null,O=0}}var V=function(n){return null==n.id?1/0:n.id};function N(n,e){if(n.has(e)){var t=n.get(e);if(t>j)return!0;n.set(e,t+1)}else n.set(e,1)}var P={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},L=function(n){return{name:"border-".concat(n,"-color"),initialValue:"transparent",prefix:!1,type:3,format:"color"}},k=L("top"),B=L("right"),z=L("bottom"),W=L("left"),D=function(n){return 17===n.type},I=function(n){return 20===n.type},M=function(n){return{name:"border-".concat(n,"-width"),initialValue:"0",type:0,prefix:!1,parse:function(n){return function(n){return 15===n.type}(n)?n.number:0}}},F=M("top"),H=M("right"),U=M("bottom"),Y=M("left"),G={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},K={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(n){return n.filter(I).reduce((function(n,e){return n|X(e.value)}),0)}},X=function(n){switch(n){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},q={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},J={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(n){return D(n)?n.number:I(n)&&"bold"===n.value?700:400}},Q={name:"line-height",initialValue:"normal",prefix:!1,type:4},Z=function(n){return{name:"margin-".concat(n),initialValue:"0",prefix:!1,type:4}},$=Z("top"),nn=Z("right"),en=Z("bottom"),tn=Z("left"),rn={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(n){return D(n)?n.number:1}},on=function(n){return{name:"padding-".concat(n),initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},ln=on("top"),un=on("right"),an=on("bottom"),cn=on("left"),fn={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(n){switch(n){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},dn={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(n){if(20===n.type&&"none"===n.value)return null;if(18===n.type){var e=pn[n.name];if(void 0===e)throw new Error('Attempting to parse an unsupported transform function "'.concat(n.name,'"'));return e(n.values)}return null}},pn={matrix:function(n){var e=n.filter((function(n){return 17===n.type})).map((function(n){return n.number}));return 6===e.length?e:null},matrix3d:function(n){var e=n.filter((function(n){return 17===n.type})).map((function(n){return n.number})),t=e[0],r=e[1];e[2],e[3];var i=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var l=e[12],u=e[13];return e[14],e[15],16===e.length?[t,r,i,o,l,u]:null}},sn={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(n){switch(n){case"hidden":return 1;case"collapse":return 2;default:return 0}}},hn={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(n){if(20===n.type)return{auto:!0,order:0};if(D(n))return{auto:!1,order:n.number};throw new Error("Invalid z-index number parsed")}};var vn=function(n,e){return null!=e?e.toString():n.initialValue};function gn(n){return!!n&&!0===n.__v_isTreeNode}function yn(n){var e={__v_isTreeNode:!0,_children:n.children||[],parent:null,prev:null,next:null,instance:n.instance||null,set children(n){e._children=n},get children(){return e._children||[]},get root(){return t(this)},hasChildren:function(){return!(!Array.isArray(e._children)||!e._children.length)},appendChild:function(n){if(!gn(n))throw Error("Unknown treeNode type");var t=e._children[e._children.length-1]||null;t&&gn(t)&&bn(t,t.prev,n);Array.isArray(e._children)&&e._children.push(n),function(n,e){n.parent=e}(n,e),bn(n,t,null)},prependChild:function(n){if(!gn(n))throw Error("Unknown treeNode type")},removeChild:function(n){if(!gn(n))throw Error("Unknown treeNode type")},append:function(){},prepend:function(){},remove:function(){}};function t(n){return n.parent?t(n.parent):n}return e}function bn(n,e,t){n.prev=e,n.next=t}function mn(n,e){void 0===e&&(e={});var t={__v_isRenderObject:!0,options:e,root:null,container:null,nextSibling:null,prevSibling:null,children:[],element:n,node:null,renderStyle:i(n),createRenderStyle:i,updateRenderStyle:function(){},layout:function(){},reflow:function(){},appendChild:function(n){r.appendChild(n.node)}},r=yn({instance:t});function i(n){var e,t=(e=n.styles,console.log("CSSSSSSSS",e),{backgroundColor:vn(P,e.backgroundColor),borderTopColor:vn(k,e.borderTopColor),borderRightColor:vn(B,e.borderRightColor),borderBottomColor:vn(z,e.borderBottomColor),borderLeftColor:vn(W,e.borderLeftColor),borderTopWidth:vn(F,e.borderTopWidth),borderRightWidth:vn(H,e.borderRightWidth),borderBottomWidth:vn(U,e.borderBottomWidth),borderLeftWidth:vn(Y,e.borderLeftWidth),color:vn(G,e.color),display:vn(K,e.display),fontSize:vn(q,e.fontSize),fontWeight:vn(J,e.fontWeight),lineHeight:vn(Q,e.lineHeight),marginTop:vn($,e.marginTop),marginRight:vn(nn,e.marginRight),marginBottom:vn(en,e.marginBottom),marginLeft:vn(tn,e.marginLeft),opacity:vn(rn,e.opacity),paddingTop:vn(ln,e.paddingTop),paddingRight:vn(un,e.paddingRight),paddingBottom:vn(an,e.paddingBottom),paddingLeft:vn(cn,e.paddingLeft),textAlign:vn(fn,e.textAlign),transform:vn(dn,e.transform),visibility:vn(sn,e.visibility),zIndex:vn(hn,e.zIndex)});return console.log("renderStyle",n,n.styles,t),t}return t.node=r,Object.defineProperty(t,"root",{get:function(){return r.root.instance}}),Object.defineProperty(t,"container",{get:function(){return r.parent?r.parent.instance:null}}),Object.defineProperty(t,"prevSibling",{get:function(){return r.prev?r.prev.instance:null}}),Object.defineProperty(t,"nextSibling",{get:function(){return r.next?r.next.instance:null}}),Object.defineProperty(t,"children",{get:function(){return r.children.map((function(n){return n.instance}))}}),t}function xn(n){return{canvas:n.canvas,ctx:n.ctx,dpr:n.dpr||1,render:function(){}}}function _n(n){return n.paint=function(){var n=this.getRenderer();this.options.render?this.options.render(n.getCtx(),n.getCanvas(),this):(n._drawBackground(this),n._drawBox(this))},n}function Cn(n){return n.debugColor="blue",n.paint=function(){},n}var Sn=function(n){return e=n.reverse(),r=e.length,i=0,function n(){for(var o=arguments,l=[],u=0;u<arguments.length;u++)l[u]=o[u];return t=e[i].apply(this,l),i>=r-1?(i=0,t):(i++,n.call(null,t))};var e,t,r,i};function Tn(n,e,t,r){void 0===t&&(t={});var i={__v_isCanvasElement:!0,type:e,options:t,styles:t.style||{},context:n,root:null,container:null,nextSibling:null,prevSibling:null,children:[],node:null,renderObject:null,debugColor:null,appendChild:function(n){o.appendChild(n.node),i.hasRootElement()&&n.attach(i)},hasChildren:function(){return i.node.hasChildren()},attach:function(n){n.renderObject.appendChild(i.renderObject),i.hasChildren()&&i.children.forEach((function(n){n.attach(i)}))},hasRootElement:function(){return o.root&&o.root.instance&&"body"===o.root.instance.type},getRootElement:function(){if(i.hasRootElement())return o.root.instance;return null},isVisible:function(){return!0}},o=yn({instance:i});i.node=o;var u=mn(i);return i.renderObject=u,Object.defineProperty(i,"root",{get:function(){return o.root.instance}}),Object.defineProperty(i,"container",{get:function(){return o.parent?o.parent.instance:null}}),Object.defineProperty(i,"prevSibling",{get:function(){return o.prev?o.prev.instance:null}}),Object.defineProperty(i,"nextSibling",{get:function(){return o.next?o.next.instance:null}}),Object.defineProperty(i,"children",{get:function(){return l(r)?r:o.children.map((function(n){return n.instance}))}}),"body"===i.type&&(i.styles={width:"100%",height:"100%"}),i}var En={createAppAPI:T,createNodeOps:function(n){return{insert:function(n,e,t){n&&e.appendChild(n)},remove:function(n){},createElement:function(e,t){var r=(t=t||{}).style;return n("view",{style:r})},createText:function(e){return n("text",{},e)},createComment:function(n){},setText:function(n,e){},setElementText:function(n,e){},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling}}},createRenderer:function(t){var r=t.insert,i=t.remove,o=t.patchProp,l=t.createElement,u=t.createText;t.createComment;var a=t.setText,c=t.setElementText;t.parentNode;var f=t.nextSibling,d=function(n,e,t,r,i){if(void 0===r&&(r=null),void 0===i&&(i=null),n!==e)if(n&&!function(n,e){return n.type===e.type}(n,e)&&(r=R(n),x(n,i,!0),n=null),"Text"===e.type)p(n,e,t,r);else s(n,e,t,r,i)},p=function(n,e,t,i){null==n?r(u(e.children),t,i):e.children!==n.children&&a(e,e.children)},s=function(n,e,t,r,i){null==n?h(e,t,r,i):g(n,e,i)},h=function(n,e,t,i){var o;n.type;var u=n.props;o=n.el=l(n.type,u),v(n.children,o,null,i),r(o,e,t)},v=function(n,e,t,r,i){if(void 0===i&&(i=0),"string"==typeof n)d(null,C(n),e,t,r);else for(var o=i;o<n.length;o++){var l=C(n[o]);d(null,l,e,t,r)}},g=function(e,t,r){var i=t.el=e.el,o=e.props||n,l=t.props||n;y(e,t,i,null,r),e.children!==t.children&&c(i,t.children),m(i,t,o,l,r)},y=function(n,e,t,r,i){var o=n&&n.children,l=e.children;b(o,l,t,r,i)},b=function(n,t,r,i,o){t=t||e;var l,u=(n=n||e).length,a=t.length,c=Math.min(u,a);for(l=0;l<c;l++){var f=C(t[l]);d(n[l],f,r,null,o)}u>a?S(n,o,!0,!1,c):v(t,r,i,o,c)},m=function(e,t,r,i,l){if(r!==i){if(r!==n)for(var u in r)o(e,u,r[u],null,t.children,l,S);for(var u in i){var a=i[u],c=r[u];a!==c&&"value"!==u&&o(e,u,c,a,t.children,l,S)}"value"in i&&o(e,"value",r.value,i.value)}},x=function(n,e,t,r){void 0===t&&(t=!1),n.type,n.props;var i=n.children;S(i,e),t&&_(n)},_=function(n){i(n)},S=function(n,e,t,r,i){void 0===t&&(t=!1),void 0===i&&(i=0);for(var o=i;o<n.length;o++)x(n[o],e,t)},R=function(n){return f(n)},w=function(n,e){null==n?e._vnode&&x(e._vnode,null,!0):d(e._vnode||null,n,e,null,null),function(n,e){for(void 0===e&&(e=0),n=n||new Map;e<E.length;e++){var t=E[e];if(t&&t.pre){if(N(n,t))continue;E.splice(e,1),e--,t()}}}(),A(),e._vnode=n};return{render:w,createApp:T(w)}},h:function(n,e,t){var r=arguments.length;return 2===r?u(e)&&!i(e)?y(e)?b(n,null,[e]):b(n,e):b(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):3===r&&y(t)&&(t=[t]),b(n,e,t))},createDoCanvas:function(n){var e,t=function(){var n={rootRenderObject:null,createRoot:function(e){n.createRenderTree(e)},createRenderTree:function(e){n.rootRenderObject=mn(e)}};return n}(),r=(e=t,function(n,t,r){return void 0===t&&(t={}),"text"===n?Sn([Cn,Tn])(e,n,t,r):Sn([_n,Tn])(e,n,t,r)}),i={body:null,engine:t,renderer:xn(n),createElement:r};return i.body=r("body"),t.createRoot(i.body),i.renderer.render(),i}};return En}));
//# sourceMappingURL=x-canvas.js.map
